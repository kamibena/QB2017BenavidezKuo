---
title: "Co-occurrence of tree species in a small tropical island "
author: "Venus Kuo and Michelle Benavidez, Quantitative Biodiversity, Indiana University"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
geometry: margin=2.54cm
---

## Directions:
1. Change "Add title of your project" on line 2 (above) to the name of your project.
2. Change "Add names of team members" on line 3 (above) to the names of team members in your project.
3. Write a <250 word Abstract describing your team's research.
4. Write a 1-2 paragraph Introduction providing some background and context for your project.
5. Set up your working enviroment (set directory, load packages) using the `/Week8-Projects` folder. 
6. Provide a brief (~1 paragraph) description of the dataset.
7. Load the dataset and process in ways necessary for any initial analyses.
8. Use well annotated R chunks to analyze data, make figures, and peform statistics needed to address your quesstions and hypotheses. 
9. Write a Discussion and Conclusion section to address the questions and hypotheses that you outlined in you outlined in your Abstract and Introuction.
10. Include citations in the Reference section.
11. Delete the text in this Directions section.
12. By Thursday March 9, 23:59, please submit the completed assignment by creating a **pull request** via GitHub. Your pull request should include this file *Project_assignment.Rmd* and the PDF output of `Knitr` (*Project_assignment.pdf*). 

## ABSTRACT
Perhaps the most well-documented neutral model of biodiversity is the Unified Neutral Theory of Biodiversity (UNTB), however there is some controversy concerning the utility of UNTB compared to other null models og biodiversity.  UNTB postulates that species richness and abundance is generated exclusively through genetic drift between species.  Consequently, one should expect that a community governed by UNTB would have predominantly random species associations at any given point in time.  For this study we analyzed tree species associations on Barro Colorado Island in Panama.  Rank abundance of all individuals in the study site followed a log normal distribution.  Among sites, we found that only 21.3% of tree associations were nonrandom, of which 64.64% were positive associations and 35.36% were negative associations.  The frequency of this distribution of associaitons was not significantly different from the frequencies of a randomly generated distribution (x2 = 0.336, df = 1, p = 0.562).  Future research should focus on comparing various null distribution models to see if UNTB better explains this seemingly random distribution.       

## 1) INTRODUCTION

Hubbell (2001) developed the unified Neutral Theory of Biodiversity (UNTB) to explain the diversity and abundances of species in ecological communities by assuming per capita ecological equivalence among all individuals of every species in the same trophic level. UNTB acts as a null hypothesis for niche-theory by stripping away the complexity and asking: How much of the patterns of ecological communities assembly is explained by species similarity rather than differences (Bell 2000; Hubbell 2001). Hubbell (2006) argues that ecological equivalence can easily evolve in high diversity, dispersal and recruitment limited communities, like in Barro Colorado Island in Panama. In a highly complex environment, species do not evolve or evolves slowly due to low pairwise encounters frequencies between any two species (Hubbell 2006). This idea of species co-occurrence is central to the fundamental assumptions of UNTB, and we aim to explore if indeed this co-occurrences between species on BCI is just by random change. We hypothesize that if community composition in highly diverse ecosystems is primarily determined by neutral processes, then on Barro Colorado Island we expect to observe predominantly random associations for tree species present among sites.

On Barro Colorado Island, tree surveys have taken place 

## 2) SETUP

```{r}
## Setup work enviroment ##
rm(list = ls())
setwd("C:/Users/Venus/Github/QB2017BenavidezKuo/data")
## Load packages ##
require("vegan")  
require("tidyr")
require("dplyr")
require("cooccur")
```

## 3) DESCRIPTION OF DATA

We took 2010 census BCI 50ha plot dataset that contains long form individual ID number, Species name, Quadrat, PX and PY 50 ha coordinate grid, date censused, status, and DBH. I subsetted the dataset to just include the individual ID number, species name (Latin), Quadrat, and the PX and PY coordinates. 

## 4) LOAD THE DATA

```{r}
# From BCI, Panama from year 2010 #
BCI <- read.delim("BCI2010.txt", header=T)
# Slim down BCI data frame #
BCI.df <- subset(BCI, select = c(Latin, Quadrat))
```

## 5) ANALYSIS: FIGURES AND STATISTICS

```{r}

#pretty little chart of trees ploted of the plot
plot(BCI$PX,BCI$PY, col=as.numeric(BCI$Latin),pch = 19, cex = 0.3, xlab = "", ylab = "", main = "Tree Species on the 50 Hectare Plot in Barro Colorado Island")

#Good's coverage
C <- function(x = ""){
  1 - (sum(x == 1) / rowSums(x))
}

#create species by site incidence matrix
BCI.SbyS <- group_by(BCI, Quadrat) %>% count(Latin) %>% spread(key=Latin, value=n , fill=0)
BCI.SBS <- BCI.SbyS[ ,-1]
BCI.SpbS=t(BCI.SBS)
BCI.SpbS[BCI.SpbS > 0] <- 1

#creating cooccur dataframe 
BCIcooc <- cooccur::cooccur(mat = BCI.SpbS, type = "spp_site", thresh = T, spp_names = T)

#species associaitons profile
cooccur::pair.profile(BCIcooc)
cooccur::pair.attributes(BCIcooc)

#observed vs expected line graph - for observed distributions
cooccur::obs.v.exp(BCIcooc)

#associations of top four most abundant species
cooccur::pair(mod = BCIcooc, "Hybanthus prunifolius")
cooccur::pair(mod = BCIcooc, "Faramea occidentalis")
cooccur::pair(mod = BCIcooc, "Desmopsis panamensis")
cooccur::pair(mod = BCIcooc, "Trichilia tuberculata")

#Random matrix assortment and cooccur dataframe
BCI.df.random <- transform(BCI.df, Quadrat = sample(Quadrat))
BCI.SbyS.r <- group_by(BCI.df.random, Quadrat) %>% count(Latin) %>% spread(key=Latin, value=n , fill=0)
BCI.SBS.r <- BCI.SbyS.r[ ,-1]
BCI.SpbS.r <- t(BCI.SBS.r)
BCI.SpbS.r[BCI.SpbS.r > 0] <- 1
BCIcooc.rand <- cooccur::cooccur(mat = BCI.SpbS.r, type = "spp_site", thresh = T, spp_names = T)
summary(BCIcooc.rand)



#chisquare between frequencies of random resesults and observed results
exp.pos <- 1669/31620
exp.neg <- 573/31620
exp.rand <- 29378/31620
obs.pos <- 3742/27202
obs.neg <- 2047/27202
obs.rand <- 2143/2702

x2 <- (((obs.pos-exp.pos)^2)/exp.pos) + (((obs.neg-exp.neg)^2)/exp.neg) + (((obs.rand-exp.rand)^2)/exp.rand)

1-pchisq(x2,1)

```
## 6) DISCUSSION AND CONCLUSION

Results from the study suggest that tree community composition on Barro Colorado Island in Panama is randomly distributed.  However, these results do not necessarily support the assumptions of the Unified Theory of Biodiversity.  


## 7) REFERENCES

Bell, Graham. "The distribution of abundance in neutral communities." The American Naturalist 155.5 (2000): 606-617.

Griffith, Veech, and Marsh (2016). cooccur: Probabilistic Species Co-Occurrence Analysis in R. Journal of Statistical Software, 69(2), 1-17. doi:10.18637/jss.v069.c02

Hubbell, Stephen P. "Neutral theory and the evolution of ecological equivalence." Ecology 87.6 (2006): 1387-1398.

Hubbell, S.P. (2001). A Unified Neutral Theory of Biodiversity and Biogeography. Princeton University Press. Princeton NJ.

Veech (2013). A probabilistic model for analysing species co-occurrence. Global Ecology and Biogeography, DOI: 10.1111/j.1466-8238.2012.00789.